<section>
  <h2>Cursos</h2>
  
  <!-- Campo de busca vulnerável -->
  <form method="get" action="/courses" class="row">
    <input type="text" class="grow" name="search" value="<%- search || '' %>" placeholder="Buscar cursos..." />
    <button class="button">Buscar</button>
  </form>
  
  <% if (search) { %>
    <p>Resultados para: <span class="html"><%- search %></span></p>
  <% } %>
  
  <!-- Mensagens de erro e sucesso via query string -->
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const error = urlParams.get('error');
    const success = urlParams.get('success');
    
    if (error) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error';
      errorDiv.textContent = error;
      document.querySelector('section').insertBefore(errorDiv, document.querySelector('table'));
    }
    
    if (success) {
      const successDiv = document.createElement('div');
      successDiv.style.cssText = 'background: linear-gradient(135deg, #D1FAE5, #A7F3D0); color: #047857; padding: 20px 28px; border: 3px solid #6EE7B7; border-radius: var(--radius-sm); font-weight: 600; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.25); margin: var(--spacing-lg) 0;';
      successDiv.textContent = success;
      document.querySelector('section').insertBefore(successDiv, document.querySelector('table'));
    }
  </script>
  
  <% if (typeof error !== 'undefined' && error) { %>
    <div class="error"><%= error %></div>
  <% } %>
  
  <table>
    <thead><tr><th>ID</th><th>Código</th><th>Título</th><th>Vagas</th><th>Ações</th></tr></thead>
    <tbody>
      <% courses.forEach(c => { %>
        <tr>
          <td><%= c.id %></td>
          <td><%= c.code %></td>
          <td><%= c.title %></td>
          <td><%= c.seats %></td>
          <td>
            <form method="post" action="/courses/<%= c.id %>/enroll">
              <button>Matricular</button>
            </form>
            <% if (isAdmin) { %>
              <form method="post" action="/courses/<%= c.id %>/delete" style="margin-top:4px">
                <button class="button danger">Excluir (admin via JWT)</button>
              </form>
            <% } %>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</section>
