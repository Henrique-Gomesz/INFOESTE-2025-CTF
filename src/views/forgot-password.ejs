<section class="container-narrow">
  <div class="card">
    <div class="card-body">
      <h2>Recuperar Senha</h2>
      <% if (error) { %>
        <div class="error"><%= error %></div>
      <% } %>
      <% if (message) { %>
        <div style="background: linear-gradient(135deg, #D1FAE5, #A7F3D0); color: #047857; padding: 20px 28px; border: 3px solid #6EE7B7; border-radius: var(--radius-sm); font-weight: 600; box-shadow: 0 8px 24px rgba(16, 185, 129, 0.25); margin: var(--spacing-lg) 0; letter-spacing: 0.3px;">
          <%= message %>
        </div>
      <% } %>
      
      <% if (!showOtpForm) { %>
      <form method="post" action="/forgot-password">
        <label>Email
          <input name="email" type="email" placeholder="seu@email.com" required />
        </label>
        <button type="submit" class="btn">Enviar Código de Verificação</button>
      </form>
      <% } else { %>
      
      <script>
      function showOtpFromCookie() {
        const resetCookie = getCookie('reset_otp');
        if (resetCookie) {
          try {
            const otpData = JSON.parse(resetCookie);
            document.getElementById('otp-code-display').textContent = otpData.otp;
            document.getElementById('cookie-otp-display').style.display = 'block';
            
            // Auto-preenche o campo OTP
            const otpInput = document.querySelector('input[name="otp"]');
            if (otpInput) {
              otpInput.value = otpData.otp;
            }
          } catch (e) {
            alert('Erro ao ler cookie: ' + e.message);
          }
        } else {
          alert('Cookie reset_otp não encontrado!');
        }
      }
      
      function getCookie(name) {
        const value = "; " + document.cookie;
        const parts = value.split("; " + name + "=");
        if (parts.length === 2) return parts.pop().split(";").shift();
      }
      </script>
      <form method="post" action="/reset-password" class="reset-password-form">
        <input type="hidden" name="email" value="<%= email %>" />
        <label>Código de Verificação (OTP)
          <input name="otp" type="text" class="otp-input" placeholder="000000" maxlength="6" required />
        </label>
        <label>Nova Senha
          <input name="password" type="password" placeholder="Digite sua nova senha" required />
        </label>
        <label>Confirmar Nova Senha
          <input name="confirmPassword" type="password" placeholder="Confirme sua nova senha" required />
        </label>
        <button type="submit" class="btn">Redefinir Senha</button>
      </form>
      <% } %>
      
      <div style="text-align: center; margin-top: var(--spacing-lg);">
        <a href="/login">Voltar ao Login</a>
      </div>
    </div>
  </div>
</section>